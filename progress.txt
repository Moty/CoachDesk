# Ralph Progress Log
Started: Thu Jan 22 23:47:56 PST 2026
---

## 2026-01-23T09:08 - US-001
- Created web/ workspace with Vite + React + TypeScript
- Added npm scripts: dev, build, preview, test, typecheck
- Created web/src/main.tsx and web/src/App.tsx with basic render
- Configured build output to web/dist
- Added web/tsconfig.json and web/vite.config.ts
- Added web/.env.example with VITE_API_BASE_URL and VITE_FIREBASE_* placeholders
- All tests pass, typecheck passes
- Files changed: web/package.json, web/vite.config.ts, web/tsconfig.json, web/tsconfig.node.json, web/.env.example, web/index.html, web/src/main.tsx, web/src/App.tsx, web/vitest.config.ts, web/src/App.test.tsx
- **Learnings for future iterations:**
  - [PATTERN]: Vite + React projects use jsx: "react-jsx" to avoid importing React in every component
  - [PATTERN]: Vitest requires jsdom environment for React component tests
  - [INTEGRATION]: Frontend workspace is in web/ directory, separate from backend
---

## 2026-01-23T09:10 - US-002
- Installed and configured React Router
- Created Layout component with header, navigation, and main content slot
- Added route placeholders: /, /ticket/:id, /ticket/new, /admin, and 404 not-found
- Verified in browser at http://localhost:5173/
- Typecheck passes
- Files changed: web/package.json, web/src/App.tsx, web/src/components/Layout.tsx, web/src/pages/TicketsPage.tsx, web/src/pages/TicketDetailPage.tsx, web/src/pages/CreateTicketPage.tsx, web/src/pages/AdminPage.tsx, web/src/pages/NotFoundPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: React Router v6 uses <Routes> and <Route element={...}> syntax
  - [PATTERN]: Layout wrapper shares header/nav across all routes
---

## 2026-01-23T09:12 - US-003
- Installed Firebase SDK
- Created firebase.ts with Firebase config from env vars
- Created AuthProvider/context with user, loading state, and getIdToken helper
- Added signIn and signOut helpers using Firebase Auth
- Wrapped app with AuthProvider to make auth state accessible app-wide
- Added vite-env.d.ts for TypeScript env var types
- Tests pass, typecheck passes
- Files changed: web/package.json, web/src/firebase.ts, web/src/contexts/AuthContext.tsx, web/src/App.tsx, web/src/vite-env.d.ts
- **Learnings for future iterations:**
  - [PATTERN]: Vite env vars need TypeScript declarations in vite-env.d.ts
  - [PATTERN]: Firebase Auth state is managed via onAuthStateChanged listener
  - [INTEGRATION]: AuthProvider wraps entire app to provide auth context
---

## 2026-01-23T09:13 - US-004
- Created LoginPage with email/password form
- Created ProtectedRoute component that redirects unauthenticated users to /login
- Updated routing to protect all routes except /login
- Added sign-out button in header user menu showing current user email
- Typecheck passes
- Files changed: web/src/pages/LoginPage.tsx, web/src/components/ProtectedRoute.tsx, web/src/App.tsx, web/src/components/Layout.tsx
- **Learnings for future iterations:**
  - [PATTERN]: ProtectedRoute checks auth state and redirects if not authenticated
  - [PATTERN]: Header shows user email and sign-out button when authenticated
  - [INTEGRATION]: Login page is public, all other routes are protected
---

## 2026-01-23T09:14 - US-005
- Created ApiClient class with get/post/patch/delete methods
- Attaches Authorization: Bearer <token> from AuthProvider to requests
- Handles backend error format { code, message, details } with user-friendly messages
- Supports pagination and filtering via query params
- Supports multipart/form-data file upload with field name 'file'
- Integrated apiClient into AuthContext for app-wide access
- Tests pass, typecheck passes
- Files changed: web/src/lib/apiClient.ts, web/src/contexts/AuthContext.tsx
- **Learnings for future iterations:**
  - [PATTERN]: ApiClient takes getToken function as constructor param
  - [PATTERN]: File uploads use FormData with 'file' field name
  - [INTEGRATION]: apiClient is exposed via useAuth hook for easy access
---

## 2026-01-23T09:15 - US-006
- Created User type with role field (customer/agent/admin)
- Updated AuthContext to fetch current user via GET /api/v1/users/me on auth state change
- Store user role in auth state
- Created RoleGuard component to gate routes by role
- Admin route now requires agent or admin role, shows access denied for customers
- Typecheck passes
- Files changed: web/src/types/user.ts, web/src/contexts/AuthContext.tsx, web/src/components/RoleGuard.tsx, web/src/App.tsx, web/src/components/Layout.tsx
- **Learnings for future iterations:**
  - [PATTERN]: User role is fetched from backend on auth state change
  - [PATTERN]: RoleGuard shows access denied state for unauthorized roles
  - [INTEGRATION]: firebaseUser is separate from backend user with role
---

## 2026-01-23T09:16 - US-007
- Created Ticket and PaginatedResponse types
- Implemented Tickets page that calls GET /api/v1/tickets with pagination
- Renders ticket rows with subject (as link), status, priority, requester, and updatedAt
- Shows empty-state message when no tickets match
- Pagination controls (Previous/Next buttons)
- Typecheck passes
- Files changed: web/src/types/ticket.ts, web/src/pages/TicketsPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: Pagination uses page and pageSize query params
  - [PATTERN]: Empty state shows friendly message when no data
  - [INTEGRATION]: Ticket list links to detail pages via /ticket/:id
---

## 2026-01-23T09:17 - US-008
- Added filters for status, priority, assignee, and tags to Tickets page
- Added sorting controls for createdAt, updatedAt, and priority
- Filters and sorting update API query params
- Resetting page to 1 when filters change
- Typecheck passes
- Files changed: web/src/pages/TicketsPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: Filters are passed as query params to API
  - [PATTERN]: Page resets to 1 when filters change to avoid empty results
  - [INTEGRATION]: Sorting uses sortBy and sortOrder query params
---

## 2026-01-23T09:17 - US-009
- Created Ticket Detail page that loads GET /api/v1/tickets/:id
- Displays ticket metadata: status, priority, assignee, requester, tags, SLA timers
- Shows not-found state when ticket does not exist
- Typecheck passes
- Files changed: web/src/pages/TicketDetailPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: useParams hook extracts route params
  - [PATTERN]: Conditional rendering for optional fields like firstResponseAt
  - [INTEGRATION]: Ticket detail shows all metadata in a grid layout
---

## 2026-01-23T09:18 - US-010
- Created Comment type
- Load comments via GET /api/v1/tickets/:id/comments with pagination
- Render comments timeline with author, timestamp, and visibility label
- Hide internal comments from customers
- Yellow background for internal comments
- Pagination controls for comments
- Typecheck passes
- Files changed: web/src/types/comment.ts, web/src/pages/TicketDetailPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: Comments filtered client-side to hide internal comments from customers
  - [PATTERN]: Internal comments have yellow background (#fff3cd)
  - [INTEGRATION]: Comments loaded separately with their own pagination state
---

## 2026-01-23T09:20 - US-011
- Added comment composer that posts to POST /api/v1/tickets/:id/comments
- Agents/admins can choose public vs internal via checkbox; customers always public
- New comment appends to timeline without full page refresh
- Typecheck passes, tests pass
- Files changed: web/src/pages/TicketDetailPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: Form submission prevents default and handles async API calls
  - [PATTERN]: Conditional rendering for role-specific UI (internal checkbox for agents/admins)
  - [INTEGRATION]: Comment state updated optimistically after successful POST
---

## 2026-01-23T11:34 - US-012
- Created ticket form that posts to POST /api/v1/tickets
- Validates subject (1-255 chars) and description (1+ chars) before submit
- Supports priority dropdown (low/medium/high/urgent) and tags input (comma-separated)
- Navigates to new ticket detail on success
- Shows validation errors with red borders and error messages
- Cancel button returns to tickets list
- Typecheck passes, tests pass
- Files changed: web/src/pages/CreateTicketPage.tsx, prd.json
- **Learnings for future iterations:**
  - [PATTERN]: Form validation checks trim() length for required text fields
  - [PATTERN]: Tags input accepts comma-separated values, split and filtered before posting
  - [INTEGRATION]: Navigate to ticket detail page after successful creation using response.id
---

## 2026-01-23T11:37 - US-013
- Added status/priority/tags update controls using PATCH /api/v1/tickets/:id
- Added assignee picker using PATCH /api/v1/tickets/:id/assign
- Prevented invalid status transitions (open竊端in_progress,resolved,closed], in_progress竊端open,resolved,closed], resolved竊端closed,open], closed竊端open])
- Edit mode with Save/Cancel buttons for agents/admins only
- Status and priority use dropdown selects, tags use text input, assignee uses text input
- Typecheck passes, tests pass
- Files changed: web/src/pages/TicketDetailPage.tsx, prd.json
- **Learnings for future iterations:**
  - [PATTERN]: TypeScript requires type casting for select onChange when using discriminated union types
  - [PATTERN]: Status transition validation happens client-side with validTransitions lookup object
  - [INTEGRATION]: Ticket updates and assignee changes use separate PATCH endpoints
  - [GOTCHA]: Must type state variables as Ticket['status'] and Ticket['priority'] to match strict types
---

## 2026-01-23T11:42 - US-014
- Created Attachment type with id, filename, contentType, size, url, uploadedBy, createdAt fields
- Added attachment uploader that posts to POST /api/v1/tickets/:id/attachments with 'file' field
- Enforces 10MB file size limit before upload with client-side validation
- Shows uploaded attachments in ticket timeline with download links, filename, size, and timestamp
- File input resets after successful upload
- Typecheck passes, tests pass
- Files changed: web/src/types/attachment.ts, web/src/pages/TicketDetailPage.tsx
- **Learnings for future iterations:**
  - [PATTERN]: File uploads use apiClient.uploadFile() method with multipart/form-data
  - [PATTERN]: File size validation (10MB) happens client-side before upload
  - [INTEGRATION]: Attachments are loaded via GET /api/v1/tickets/:id/attachments and displayed before comments
  - [GOTCHA]: File input element must be manually reset after successful upload using querySelector
---

## 2026-01-23T19:43 - US-015
- Created AdminUsersPage with user listing and creation form
- Added role filter for users (all/customer/agent/admin)
- Added user creation form with email, displayName, and role fields
- Form validates and surfaces API errors
- Updated AdminPage to route to users sub-page
- Updated App.tsx to restrict admin routes to admin role only
- Typecheck passes
- Files changed: web/src/pages/AdminUsersPage.tsx, web/src/pages/AdminPage.tsx, web/src/App.tsx, prd.json
- **Learnings for future iterations:**
  - [PATTERN]: Admin pages use nested routing with AdminPage as container
  - [PATTERN]: Form state managed with local useState hooks
  - [INTEGRATION]: API client handles GET with query params for filtering
---
